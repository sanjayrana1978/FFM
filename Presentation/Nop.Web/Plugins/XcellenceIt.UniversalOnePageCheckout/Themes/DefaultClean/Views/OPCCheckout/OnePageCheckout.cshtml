@*
    // *************************************************************************
    // *                                                                       *
    // * Universal One Page Checkout Plugin for nopCommerce                    *
    // * Copyright (c) Xcellence-IT. All Rights Reserved.                      *
    // *                                                                       *
    // *************************************************************************
    // *                                                                       *
    // * Email: info@nopaccelerate.com                                         *
    // * Website: http://www.nopaccelerate.com                                 *
    // *                                                                       *
    // *************************************************************************
    // *                                                                       *
    // * This  software is furnished  under a license  and  may  be  used  and *
    // * modified  only in  accordance with the terms of such license and with *
    // * the  inclusion of the above  copyright notice.  This software or  any *
    // * other copies thereof may not be provided or  otherwise made available *
    // * to any  other  person.   No title to and ownership of the software is *
    // * hereby transferred.                                                   *
    // *                                                                       *
    // * You may not reverse  engineer, decompile, defeat  license  encryption *
    // * mechanisms  or  disassemble this software product or software product *
    // * license.  Xcellence-IT may terminate this license if you don't comply *
    // * with  any  of  the  terms and conditions set forth in  our  end  user *
    // * license agreement (EULA).  In such event,  licensee  agrees to return *
    // * licensor  or destroy  all copies of software  upon termination of the *
    // * license.                                                              *
    // *                                                                       *
    // * Please see the  License file for the full End User License Agreement. *
    // * The  complete license agreement is also available on  our  website at *
    // * http://www.nopaccelerate.com/enterprise-license                       *
    // *                                                                       *
    // *************************************************************************
*@

@model OnePageCheckoutExtendedModel

@using Nop.Web.Framework.Themes
@inject IWebHelper webHelper
@inject IWorkContext workContext
@inject OrderSettings orderSettings
@inject IThemeContext themeContext

@{
    Layout = "_ColumnsOne";

    var themeName = await themeContext.GetWorkingThemeNameAsync();

    var storeLocation = webHelper.GetStoreLocation();

    //title
    NopHtml.AddTitleParts(T("PageTitle.Checkout").Text);
    //page class
    NopHtml.AppendPageCssClassParts("html-checkout-page");

}
<link rel="stylesheet" href="~/Plugins/XcellenceIt.UniversalOnePageCheckout/Content/css/jquery.mCustomScrollbar.css" />
<link rel="stylesheet" href="~/Plugins/XcellenceIt.UniversalOnePageCheckout/Content/css/fontawesome-all.min.css" />
<link rel="stylesheet" href="~/Plugins/XcellenceIt.UniversalOnePageCheckout/Content/css/Universal.OpcCheckout.Common.css" />
<link rel="stylesheet" href="~/Plugins/XcellenceIt.UniversalOnePageCheckout/Themes/@themeName/Content/css/Universal.OpcCheckout.css" />

<script asp-exclude-from-bundle="true" src="~/Plugins/XcellenceIt.UniversalOnePageCheckout/Content/Scripts/universal.opconepagecheckout.js" asp-location="Footer"></script>
<script asp-exclude-from-bundle="true" src="~/Plugins/XcellenceIt.UniversalOnePageCheckout/Content/Scripts/jquery.blockUI.js" asp-location="Footer"></script>
<script asp-exclude-from-bundle="true" src="~/Plugins/XcellenceIt.UniversalOnePageCheckout/Content/Scripts/jquery.mCustomScrollbar.concat.min.js" asp-location="Footer"></script>


<script asp-location="Footer">
    $(".ajax-loading-block-window").addClass("loader-overlay");
    $('.ajax-loading-block-window').show();
</script>
<div class="page checkout-page universal-checkout-page">
    <div class="page-title">
        <h1>@T("Checkout")</h1>
    </div>
    <div class="page-body checkout-data">
        @await Component.InvokeAsync("Widget", new { widgetZone = PublicWidgetZones.OpcContentBefore })
        <div class="opc" id="checkout-steps">
            <div class="center-2">
                <div class="address-column">
                    <div id="opc-billing" class="opc-block allow">
                        <div class="step-title">
                            <h2 class="title">@T("Checkout.BillingAddress")</h2>
                        </div>
                        <div id="checkout-step-billing" class="step list a-item">
                            <form id="co-billing-form" action="">
                                <div id="checkout-billing-load">
                                    @await Html.PartialAsync("OpcBillingAddress", Model.OnePageCheckoutModel.BillingAddress)
                                    @*billing address content will be loaded here*@
                                </div>
                            </form>
                            <script asp-location="Footer">
                                Billing.init('#co-billing-form', '@(storeLocation)opccheckout/OpcSaveBilling/', @(Model.OnePageCheckoutModel.DisableBillingAddressCheckoutStep.ToString().ToLowerInvariant()));
                                if ($("#billing-address-select").length > 0) {
                                    Billing.newAddress(!$('#billing-address-select').val());
                                }
                                // add new billing address
                                $(document).on("click", "#addNewBillingAddress", function () {
                                    Billing.saveNewAddress();
                                });
                            </script>
                            <span class="please-wait" id="billing-please-wait" style="display: none;">@T("Common.LoadingNextStep")</span>
                        </div>
                    </div>
                    @if (Model.OnePageCheckoutModel.ShippingRequired)
                    {
                        <div id="opc-shipping" class="opc-block allow">
                            <div class="step-title">
                                <h2 class="title">@T("Checkout.ShippingAddress")</h2>
                            </div>
                            <div id="checkout-step-shipping" class="step list a-item">
                                <form action="" id="co-shipping-form">
                                    <div id="checkout-shipping-load">
                                        @await Html.PartialAsync("OpcShippingAddress", Model.CheckoutShippingAddressModel)
                                        @*shipping address content will be loaded here*@
                                    </div>
                                </form>
                                <script asp-location="Footer">
                                    Shipping.init('#co-shipping-form', '@(storeLocation)opccheckout/OpcSaveShipping/');
                                    if ($("#shipping-address-select").length > 0) {
                                        Shipping.newAddress(!$('#shipping-address-select').val());
                                    }
                                    // add new shipping address
                                    $(document).on("click", "#addNewShippingAddress", function () {
                                        Shipping.saveNewAddress();
                                    });
                                </script>
                                <span id="shipping-please-wait" class="please-wait" style="display: none;"> @T("Common.LoadingNextStep")</span>
                            </div>
                        </div>
                    }
                </div>
                <div class="shipping-column">
                    <div class="shipping-method-column">
                        @if (Model.OnePageCheckoutModel.ShippingRequired)
                        {
                            <div id="opc-shipping_method" class="opc-block allow">
                                <div class="step-title">
                                    <h2 class="title">@T("Checkout.ShippingMethod")</h2>
                                </div>
                                <div id="checkout-step-shipping-method" class="step list a-item">
                                    <form id="co-shipping-method-form" action="">
                                        <div id="checkout-shipping-method-load">
                                            @*shipping methods content will be loaded here*@
                                        </div>
                                        <script asp-location="Footer">
                                            ShippingMethod.init('#co-shipping-method-form', '@(storeLocation)opccheckout/OpcSaveShippingMethod/');
                                        </script>
                                        @*<div class="buttons" id="shipping-method-buttons-container">
                                            <p class="back-link">
                                                <a href="#" onclick="Checkout.back(); return false;"><small>&laquo; </small>@T("Common.Back")</a>
                                            </p>
                                            <input type="button" class="button-1 shipping-method-next-step-button" onclick="ShippingMethod.save()" value="@T(" Common.Continue")" />
                                        </div>*@
                                        <span id="shipping-method-please-wait" class="please-wait" style="display: none;">@T("Common.LoadingNextStep")</span>
                                    </form>
                                </div>
                            </div>
                        }
                    </div>
                    <div class="payment-method-column">
                        <div id="opc-payment_method" class="opc-block allow">
                            <div class="step-title">
                                <h2 class="title">@T("Checkout.PaymentMethod")</h2>
                            </div>
                            <div id="checkout-step-payment-method" class="step list a-item">
                                <form action="" id="co-payment-method-form">
                                    <div id="checkout-payment-method-load">
                                        @*payment methods content will be loaded here*@ Payment is not required
                                    </div>
                                </form>
                                <script asp-location="Footer">
                                    PaymentMethod.init('#co-payment-method-form', '@(storeLocation)opccheckout/OpcSavePaymentMethod/');
                                </script>
                                @*<div class="buttons" id="payment-method-buttons-container">
                                    <p class="back-link">
                                        <a href="#" onclick="Checkout.back(); return false;"><small>&laquo; </small>@T("Common.Back")</a>
                                    </p>
                                    <input type="button" class="button-1 payment-method-next-step-button" onclick="PaymentMethod.save()" value="@T(" Common.Continue")" />
                                </div>*@
                                <span class="please-wait" id="payment-method-please-wait" style="display: none;">@T("Common.LoadingNextStep")</span>
                            </div>
                        </div>
                    </div>
                    <div class="discount-code-column">
                        @if (Model.ShoppingCartModel.IsEditable)
                        {
                            <form action="" id="co-discountgift-form">
                                @if (Model.OnePageCheckoutConfigurationModel.EnableDiscountBox)
                                {
                                    <div id="opc-discount" class="opc-block allow">
                                        <div class="step-title">
                                            <h2 class="title">@T("ShoppingCart.DiscountCouponCode")</h2>
                                        </div>
                                        <div id="checkout-step-gift-card" class="step list a-item">
                                            <div class="cart-collaterals list">
                                                <div class="deals">
                                                    @await Html.PartialAsync("_OPCDiscountBox", Model.ShoppingCartModel.DiscountBox)
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                }
                                @if (Model.OnePageCheckoutConfigurationModel.EnableGiftCardBox)
                                {
                                    <div id="opc-gift-card" class="opc-block allow">
                                        <div class="step-title">
                                            <h2 class="title">@T("ShoppingCart.GiftCardCouponCode")</h2>
                                        </div>
                                        <div id="checkout-step-gift-card" class="step list a-item">
                                            <div class="cart-collaterals list">
                                                <div class="deals">
                                                    @await Html.PartialAsync("_OPCGiftCardBox", Model.ShoppingCartModel.GiftCardBox)
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                }
                            </form>
                        }
                    </div>
                </div>
                <div class="payment-info-column">
                    <div id="opc-payment_info" class="opc-block allow">
                        <div class="step-title">
                            <h2 class="title">@T("Checkout.PaymentInfo")</h2>
                        </div>
                        <div id="checkout-step-payment-info" class="step list a-item">
                            <form action="" id="co-payment-info-form">
                                <div id="checkout-payment-info-load">
                                    @*payment info content will be loaded here*@ Payment is not required
                                </div>
                            </form>
                            <script asp-location="Footer">
                            PaymentInfo.init('#co-payment-info-form', '@(storeLocation)opccheckout/OpcSavePaymentInfo/');
                            </script>
                            @*<div class="buttons" id="payment-info-buttons-container">
                                <p class="back-link">
                                    <a href="#" onclick="Checkout.back(); return false;"><small>&laquo; </small>@T("Common.Back")</a>
                                </p>
                                <input type="button" class="button-1 payment-info-next-step-button" onclick="PaymentInfo.save()" value="@T(" Common.Continue")" />
                            </div>*@
                            <span class="please-wait" id="payment-info-please-wait" style="display: none;">@T("Common.LoadingNextStep")</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="side-2">
                <div class="step-title">
                    <h2 class="title">@T("Opc.ShoppingCart.Order.Summary")</h2>
                </div>
                <div id="opc-confirm_order" class="opc-block allow">
                    @*<div class="step-title">
                        <h2 class="title">@T("Checkout.ConfirmOrder")</h2>
                    </div>*@
                    <div id="checkout-step-confirm-order" class="step a-item">
                        @await Html.PartialAsync("OPCUpdateCart", Model.ShoppingCartModel)
                    </div>
                    @if (Model.ShoppingCartModel.IsEditable && Model.ShoppingCartModel.Items.Count > 0 && Model.ShoppingCartModel.DisplayTaxShippingInfo)
                    {
                        var inclTax = await workContext.GetTaxDisplayTypeAsync() == TaxDisplayType.IncludingTax;
                        //tax info is already included in the price (incl/excl tax). that's why we display only shipping info here
                        //of course, you can modify appropriate locales to include VAT info there
                        <div class="tax-shipping-info">
                            @T(inclTax ? "ShoppingCart.TaxShipping.InclTax" : "ShoppingCart.TaxShipping.ExclTax", Url.RouteUrl("Topic", new { SeName = Html.GetTopicSeNameAsync("shippinginfo") }))
                        </div>
                    }
                </div>
                @*When product is not shippable some attribute not available. so we check that if no attribute exist then hide this*@
                @if (Model.ShoppingCartModel.CheckoutAttributes.Any())
                {
                    <form enctype="multipart/form-data" id="checkout-step-checkoutAttributes-form">
                        <div id="opc-checkoutAttributes" class="opc-block allow">
                            @*<div class="step-title">
                                <h2 class="title">@T("Checkout.CheckoutAttributes")</h2>
                            </div>*@
                            <div id="checkout-step-checkoutAttributes" class="step list a-item">
                                @if (Model.ShoppingCartModel.IsEditable)
                                {
                                    @await Html.PartialAsync("_OPCCheckoutAttributes", Model.ShoppingCartModel)
                                }
                                @await Component.InvokeAsync("OPCSelectedCheckoutAttributes")
                            </div>
                        </div>
                    </form>
                }
                <div id="opc-order-total" class="opc-block allow">
                    @*<div class="step-title">
                        <h2 class="title">@T("Checkout.OrderSummary")</h2>
                    </div>*@
                    <div class="totals list">
                        @await Component.InvokeAsync("OPCOrderTotals", new { isEditable = Model.ShoppingCartModel.IsEditable })
                        @if (Model.ShoppingCartModel.IsEditable)
                        {
                            if (!string.IsNullOrEmpty(Model.ShoppingCartModel.MinOrderSubtotalWarning))
                            {
                                <div class="min-amount-warning">
                                    @Model.ShoppingCartModel.MinOrderSubtotalWarning
                                </div>
                            }
                        }
                        @if (Model.ShoppingCartModel.IsEditable)
                        {
                            if (Model.ShoppingCartModel.TermsOfServiceOnShoppingCartPage)
                            {
                                <div id="terms-of-service-warning-box" title="@T(" Checkout.TermsOfService")" style="display: none;">
                                    <p>@T("Checkout.TermsOfService.PleaseAccept")</p>
                                </div>
                                <div class="terms-of-service">
                                    <input id="termsofservice" type="checkbox" name="termsofservice" />
                                    <label for="termsofservice">
                                        @T("Checkout.TermsOfService.IAccept")
                                        @if (Model.ShoppingCartModel.TermsOfServicePopup)
                                        {
                                            <a class="read" id="read-terms">@T("Checkout.TermsOfService.Read")</a>
                                            <script asp-location="Footer">
                                                $(document).ready(function () {
                                                    $('#read-terms').on('click',
                                                        function (e) {
                                                            e.preventDefault();
                                                            displayPopupContentFromUrl(
                                                                '@Url.RouteUrl("TopicPopup", new {SystemName = "conditionsofuse"})',
                                                                '@T("Checkout.TermsOfService")');
                                                        });
                                                });
                                            </script>
                                        }
                                        else
                                        {
                                            <a class="read" id="read-terms" href="@Url.RouteUrl(" Topic", new {SeName=Html.GetTopicSeNameAsync("conditionsofuse") })">@T("Checkout.TermsOfService.Read")</a>
                                        }
                                    </label>
                                </div>
                            }
                            <div class="checkout-buttons">
                                @if (string.IsNullOrEmpty(Model.ShoppingCartModel.MinOrderSubtotalWarning) && !Model.ShoppingCartModel.HideCheckoutButton)
                                {
                                    <script asp-location="Footer">
                                        $(document).ready(function () {
                                            $('#checkout').on('click', function () {
                                                //terms of service
                                                var termOfServiceOk = true;
                                                if ($('#termsofservice').length > 0) {
                                                    //terms of service element exists
                                                    if (!$('#termsofservice').is(':checked')) {
                                                        $("#terms-of-service-warning-box").dialog();
                                                        termOfServiceOk = false;
                                                    } else {
                                                        termOfServiceOk = true;
                                                    }
                                                }
                                                return termOfServiceOk;
                                            });
                                        });
                                    </script>
                                    @*if (orderSettings.CheckoutDisabled)
                                    {
                                        <div class="checkout-disabled">
                                            @T("Checkout.Disabled")
                                        </div>
                                    }
                                    else
                                    {
                                        <button type="submit" id="checkout" name="checkout" value="checkout" class="button-1 checkout-button">
                                            @T("Checkout.Button")
                                        </button>
                                    }*@
                                }
                            </div>
                            <div class="addon-buttons">
                                @*Payment method buttons (e.g. GoogleCheckoutButton, Paypal Express)*@
                                @foreach (var pm in Model.ShoppingCartModel.ButtonPaymentMethodViewComponentNames)
                                {
                                    @await Component.InvokeAsync(pm)
                                }
                            </div>
                            <script asp-location="Footer">
                                ConfirmOrder.init('@(storeLocation)opccheckout/OpcConfirmOrder/', '@(storeLocation)checkout/completed/');
                            </script>
                        }
                    </div>
                    <div class="buttons" id="confirm-order-buttons-container">
                        @*<p class="back-link">
                            <a href="#" onclick="Checkout.back(); return false;"><small>&laquo; </small>@T("Common.Back")</a>
                        </p>*@
                        <input type="button" class="button-1 confirm-order-next-step-button" onclick="PaymentInfo.save()" value="@T("Opc.ShoppingCart.Place.Order")" />
                        <span class="please-wait" id="confirm-order-please-wait" style="display: none;">@T("Checkout.SubmittingOrder")</span>
                    </div>
                </div>
            </div>
        </div>
        @await Component.InvokeAsync("Widget", new { widgetZone = PublicWidgetZones.OpcContentAfter })
    </div>
    <script asp-location="Footer">
        $(document).ready(function () {
            window.CommonDefaults.shippingRequired = "@Model.OnePageCheckoutModel.ShippingRequired";
            window.CommonDefaults.shippingRequired = (window.CommonDefaults.shippingRequired.toLowerCase() == 'true'); // Convert into boolean

            Checkout.init('@(storeLocation)cart/');

            displayAjaxLoading(true);

            if (Billing.disableBillingAddressCheckoutStep) {
                $('#opc-billing').hide();
                if (window.CommonDefaults.shippingRequired) {
                    Shipping.save();
                }
                else {
                    PaymentMethod.save();
                }
            }
            else {
                Billing.save();
            }

            $(document).on('click', '.payment-method input[type="radio"]', PaymentMethodChange);
            $(document).on('click', '.shipping-method input[type="radio"]', ShippingMethodChange);

            $('.opc-block .step-title').on('click', function () {
                var e = window, a = 'inner';
                if (!('innerWidth' in window)) {
                    a = 'client';
                    e = document.documentElement || document.body;
                }
                var result = { width: e[a + 'Width'], height: e[a + 'Height'] };
                if (result.width < 769) {
                    $(this).siblings('.list').slideToggle('slow');
                }
            });

            $('.ajax-loading-block-window').hide();
            $(".ajax-loading-block-window").removeClass("loader-overlay");
        });
        if ($(window).width() >= 769) {
            $(".step-title").click(function () {
                $title = $(this);
                //getting the next element
                $content = $title.next();
                //open up the content needed - toggle the slide- if visible, slide up, if not slidedown.
                $content.slideToggle(500);
            });
        }
    </script>
</div>
<script asp-location="Footer">
        function SetShippingAddress(id){
                    $("#shipping_address_id").val(id);
                    Shipping.save();
        }
 </script>