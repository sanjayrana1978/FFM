$(document).ready(function () {
    $("#adv").prop("checked", false);
    $("#adv").parent().hide();
    SortByCode();
    DisplayPerPage();
    ViewMode();
    PagerCode();
    PriceRange();
});

var shownextbtn = 0, isInfinit = 0;
var whenToShow = $("#nopAccplus-facetdata").attr("data-infinitescrolltill");
var whenToShowAfterLoadMore = $("#nopAccplus-facetdata").attr("data-infinitescrolltill");
var EnableAjaxRequestFacet = $("#nopAccplus-facetdata").attr("data-enableajaxrequestfacet").toLowerCase();
var productSortBy = $("#nopAccplus-facetdata").attr("data-sortbyselector");
var pageSizeSelector = $("#nopAccplus-facetdata").attr("data-pagesizeselector");
var paginationSelector = $("#nopAccplus-facetdata").attr("data-paginationselector");
var DefaultViewMode = $("#nopAccplus-facetdata").attr("data-defaultviewmode").toLowerCase();
var gridClassName = $("#nopAccplus-facetdata").attr("data-productgridselector");
var listClassName = $("#nopAccplus-facetdata").attr("data-productlistselector");
var refineButtonSelector = $("#nopAccplus-facetdata").attr("data-refinebuttonselector");
var resourceLess = $("#nopAccplus-facetdata").attr("data-resouceforless");
var resourceMore = $("#nopAccplus-facetdata").attr("data-resouceformore");
var seo_Price = $("#nopAccplus-facetdata").attr("data-seoprice");
var shownumberofproductsfound = $("#nopAccplus-facetdata").attr("data-shownoofproductsfound");
var pageBodySelector = $("#nopAccplus-facetdata").attr("data-pagebodyselector");
var featuredProductGridSelector = $("#nopAccplus-facetdata").attr("data-featuredproductgridselector");
var viewModeSelector = $("#nopAccplus-facetdata").attr("data-viewmodeselector");
var productReplaceSelector = $("#nopAccplus-facetdata").attr("data-productreplaceselector");
var EnableScrollToTop = $("#nopAccplus-facetdata").attr("data-enablescrolltotop");
var EnableScrollToTopFacetApplies = $("#nopAccplus-facetdata").attr("data-enablescrolltotopfacetapplies");
var BackToTopLabelString = $("#nopAccplus-facetdata").attr("data-backtotoplabelstring");
var EnableSearchWithin = $("#nopAccplus-facetdata").attr("data-enablesearchwithin");
var SearchWithinSelector = $("#nopAccplus-facetdata").attr("data-searchwithinselector");
var PlaceHolderForSearchWithin = $("#nopAccplus-facetdata").attr("data-placeholderforsearchwithin");
var SearchTermEmpty = $("#nopAccplus-facetdata").attr("data-searchtermempty");
var DefaultPageSize = $("#nopAccplus-facetdata").attr("data-defaultpagesize");
var scrolltotopheight = $("#nopAccplus-facetdata").attr("data-scrolltotopheight");
var MobileViewScreenSize = parseInt($("#nopAccplus-facetdata").attr("data-mobileviewscreensize"));
var SearchPageScrollFacetSelector = $("#nopAccplus-facetdata").attr("data-searchpagescrollfacetselector");
var productHtmlClass = '.data-producthtml';
var nopAccFilterClass = '.nopAcc-filter';


// Add back to top button
if (EnableScrollToTop.toLowerCase() === "true") {
    $("<div id='backTop'><span class='backtotop-button'></span><span class='backtoptop-title'>" + BackToTopLabelString + "</span></div>").appendTo(".master-wrapper-page");
}

if (EnableSearchWithin.toLowerCase() === "true") {
    $(SearchWithinSelector).prepend('<div class="nopAcc-search-box"><input type="text" class="search-box-text ui-autocomplete-input" id="nopAccSearchTerm" name="q" placeholder="' + PlaceHolderForSearchWithin + '" aria-label="Search store" autocomplete="off"><i class="fas fa-search"></i><button id="nopAcc-btnSearchWithin" class="nopAcc-search-btn">Search</button></div>')
}

var viewmodeClassName = DefaultViewMode === 'grid' ? gridClassName : listClassName;
var newviewmodeClassName = window.location.href.match(/[?&]viewmode=([^&#]+)/) || [];
if (newviewmodeClassName.length !== 0) {
    if (newviewmodeClassName[1].toLowerCase() === "list") {
        viewmodeClassName = listClassName;
    } else if (newviewmodeClassName[1].toLowerCase() === "grid") {
        viewmodeClassName = gridClassName;
    }
}
else {
    var getViewMode = '';
    var newViewMode = window.location.href.match(/[?&]viewmode=([^&#]+)/) || [];
    newViewMode !== null && newViewMode.length > 1 && (getViewMode = newViewMode[1]);
    if (getViewMode === null || getViewMode === '' || typeof getViewMode === 'undefined') {
        if ($(".product-viewmode .selected").length !== 0) {
            //dropdown logic           
            getViewMode = $("#products-viewmode").val($('#products-viewmode option[selected]').val());
            if (getViewMode === null || getViewMode === '' || typeof getViewMode === 'undefined') {
                getViewMode = DefaultViewMode;
            }
            else {
                if (getViewMode === "grid") {
                    viewmodeClassName = gridClassName;
                }
                if (getViewMode === "list") {
                    viewmodeClassName = listClassName;
                }
            }
        }
        else {
            //anchor tag logic
            var viewmode_href = $(".product-viewmode .selected").attr("href");
            var finalviewmode = DefaultViewMode;
            if ($(".product-viewmode").length !== 0) {
                if (viewmode_href !== null && typeof viewmode_href !== 'undefined') {
                    var newviewmode = viewmode_href.match(/[?&]viewmode=([^&#]+)/) || [];
                    newviewmode !== null && newviewmode.length > 1 && (finalviewmode = newviewmode[1]);
                }
                if (finalviewmode === "grid") {
                    viewmodeClassName = gridClassName;
                }
                if (finalviewmode === "list") {
                    viewmodeClassName = listClassName;
                }
            }
        }
    }
}
$(viewmodeClassName + ":not(" + featuredProductGridSelector + ")").before($(productHtmlClass + " .search-suggestions").html());

function ScrollToTop() {
    var scrollTopInt;
    var searchInput = $(SearchPageScrollFacetSelector);
    if (searchInput.length === 0) {
        scrollTopInt = $(nopAccFilterClass).offset().top;
    }
    else {
        scrollTopInt = searchInput.offset().top;
    }
    $("html, body").animate({ scrollTop: scrollTopInt - 50 }, "slow");
}

function AjaxCall(nextPageNumber, url, isHistoryCall, pageLoad) {
    if (url === null) {
        url = window.location.href;
    }
    $(".search-infinite-next").attr("style", "display:none;");
    $(".ajax-loading-block-window").attr("style", "display:block;");

    if ($(window).width() <= MobileViewScreenSize) {
        $('.header-top-bar, .mobile-navigation-bar, .header-line, .header, .header-menu, .nopAccPlus_StickyMessage, .responsive-nav-wrapper.stick, .responsive-nav-wrapper, .responsive-nav-wrapper-parent, .admin-header-links').css({
            "display": "block"
        });
    }
    $(".nop-filter-overlay").remove();

    var finalNextPage = nextPageNumber;
    if (finalNextPage === null) {
        finalNextPage = 1;
    }

    var newviewmodeClassName = window.location.href.match(/[?&]viewmode=([^&#]+)/) || [];
    if (newviewmodeClassName.length !== 0) {
        if (newviewmodeClassName[1].toLowerCase() === "list")
            viewmodeClassName = listClassName;
        else if (newviewmodeClassName[1].toLowerCase() === "grid")
            viewmodeClassName = gridClassName;

    }
    var getOrder = "";
    var getPageSize = "";
    var getViewMode = "";
    if (isHistoryCall === 1) {
        if (url !== null && url !== '' && typeof url !== 'undefined') {
            var newPageSize = /pagesize=(\d+)/.exec(url.toLowerCase());
            newPageSize !== null && newPageSize.length > 1 && (getPageSize = newPageSize[1]);
            if (getPageSize === null || getPageSize === '' || typeof getPageSize === 'undefined') {
                getPageSize = $(pageSizeSelector + ' option:selected').attr("value");
            }

            var newViewMode = url.match(/[?&]viewmode=([^&#]+)/) || [];
            newViewMode !== null && newViewMode.length > 1 && (getViewMode = newViewMode[1]);
            if (getViewMode === null || getViewMode === '' || typeof getViewMode === 'undefined') {
                if ($(".product-viewmode .selected").length !== 0) {
                    //dropdown logic
                    //getViewMode = $('#products-viewmode option:selected').attr("value");
                    getViewMode = $(".product-viewmode .selected").attr("data-viewmode");
                    if (getViewMode === null || getViewMode === '' || typeof getViewMode === 'undefined') {
                        getViewMode = DefaultViewMode;
                    }
                }
                else {
                    //anchot tag logic
                    getViewMode = $(".product-viewmode .selected").attr("data-viewmode");
                    if (getViewMode === null || getViewMode === '' || typeof getViewMode === 'undefined') {
                        getViewMode = DefaultViewMode;
                    }
                }
            }
            var newgetOrder = /orderby=(\d+)/.exec(url.toLowerCase());
            newgetOrder !== null && newgetOrder.length > 1 && (getOrder = newgetOrder[1]);
            if (getOrder === null || getOrder === '' || typeof getOrder === 'undefined') {
                getOrder = $(productSortBy + ' option:selected').attr("value");
            }
        }

        $(productSortBy).val(getOrder);
        $(pageSizeSelector).val(getPageSize);
        ViewModeChange(getViewMode);
        if ($(".product-viewmode .selected").length !== 0) {
            //dropdown logic
            $("#products-viewmode").val(getViewMode);

        }
        else {
            //anchor tag logic
            $(".product-viewmode a").removeClass("selected");
            $('.product-viewmode a[data-viewmode=' + getViewMode + ']').addClass('selected');
        }
    }
    else {

        getOrder = $(productSortBy + ' option:selected').attr("value");
        if (typeof getOrder === 'undefined') {
            getOrder = "0";
        }

        getPageSize = $(pageSizeSelector + ' option:selected').attr("value");
        if (getPageSize === null || getPageSize === '' || typeof getPageSize === 'undefined') {
            getPageSize = DefaultPageSize;
        }
        if ($(".product-viewmode .selected").length !== 0) {
            //dropdown logic
            // getViewMode = $('#products-viewmode option:selected').attr("value");
            getViewMode = $(".product-viewmode .selected").attr("data-viewmode");
            if (getViewMode === null || getViewMode === '' || typeof getViewMode === 'undefined') {
                getViewMode = DefaultViewMode;
            }
        }
        else {
            //anchor tag logic
            getViewMode = $(".product-viewmode .selected").attr("data-viewmode");
            if (getViewMode === null || getViewMode === '' || typeof getViewMode === 'undefined') {
                getViewMode = DefaultViewMode;
            }
        }
    }

    (url = new URL(url)).searchParams.set("orderby", getOrder);
    (url = new URL(url)).searchParams.set("pagesize", getPageSize);
    (url = new URL(url)).searchParams.set("viewmode", getViewMode);
    (url = new URL(url)).searchParams.set("pagenumber", finalNextPage);
    url = url.href;
    window.history.replaceState({}, document.title, url);

    if (pageLoad === 1) {
        window.location = url;
        return false;
    }
    if ($("#nopAccplus-facetdata").attr("data-enableajaxrequestfacet").toLowerCase() === "false") {
        window.location = url;
        return false;
    }
    var ajaxData = {
        url: url,
        pageSize: getPageSize,
        orderBy: getOrder,
        viewMode: getViewMode,
        pageNumber: finalNextPage,
        CurrentCategoryId: $("#nopAccplus-facetdata").attr("data-currentcategoryid"),
        ChildCategoryIds: $("#nopAccplus-facetdata").attr("data-childcategoryids"),
        ManufacturerId: $("#nopAccplus-facetdata").attr("data-manufacturerid"),
        VendorId: $("#nopAccplus-facetdata").attr("data-vendorid"),
        ProductTagId: $("#nopAccplus-facetdata").attr("data-producttagid"),
        Searchkeyword: $("#nopAccplus-facetdata").attr("data-keyword"),
    };
    $.ajax({
        url: $(nopAccFilterClass).attr("data-getfilteredproductsurl"),
        type: "POST",
        data: ajaxData
    }).success(function (result) {
        if (nextPageNumber === null) {
            $(nopAccFilterClass).replaceWith(result);

            var newItemGrid = $(nopAccFilterClass + " " + productHtmlClass).find(viewmodeClassName);
            newItemGrid.remove();

            if (viewmodeClassName == listClassName) {
                if ($(viewmodeClassName + ":not(" + featuredProductGridSelector + ")").length == 0) {
                    $(gridClassName + ":not(" + featuredProductGridSelector + ")").replaceWith(newItemGrid);
                } else {
                    $(listClassName + ":not(" + featuredProductGridSelector + ")").replaceWith(newItemGrid);
                }
            }

            if (viewmodeClassName == gridClassName) {
                if ($(viewmodeClassName + ":not(" + featuredProductGridSelector + ")").length == 0) {
                    $(listClassName + ":not(" + featuredProductGridSelector + ")").replaceWith(newItemGrid);
                } else {
                    $(gridClassName + ":not(" + featuredProductGridSelector + ")").replaceWith(newItemGrid);
                }
            }

            //var newItemGrid = $(nopAccFilterClass + " " + productHtmlClass + " " + productReplaceSelector).html();
            //$(viewmodeClassName + ":not(" + featuredProductGridSelector + ") > " + productReplaceSelector).html(newItemGrid);


            if ($(nopAccFilterClass + ' ' + productHtmlClass + ' ' + paginationSelector).length > 0) {
                var newPager = $(nopAccFilterClass + " " + productHtmlClass + " " + paginationSelector)[0].outerHTML;
                if ($(pageBodySelector + ' ' + paginationSelector).length > 0) {
                    $(paginationSelector).replaceWith(newPager);
                } else {
                    $(pageBodySelector).append(newPager);
                }
            }
            else {
                $(pageBodySelector + " " + paginationSelector).empty();
            }
        } else {
            if ($("#nopAccplus-facetdata").attr("data-infinitescroll").toLowerCase() === "false") {
                $(nopAccFilterClass).replaceWith(result);
                newItemGrid = $(nopAccFilterClass + " " + productHtmlClass + " " + productReplaceSelector).html();
                $(viewmodeClassName + ":not(" + featuredProductGridSelector + ") > " + productReplaceSelector).html(newItemGrid);
                if ($(nopAccFilterClass + ' ' + productHtmlClass + ' ' + paginationSelector).length > 0) {
                    newPager = $(nopAccFilterClass + " " + productHtmlClass + " " + paginationSelector)[0].outerHTML;
                    if ($(pageBodySelector + ' ' + paginationSelector).length > 0)
                        $(paginationSelector).replaceWith(newPager);
                    else
                        $(pageBodySelector).append(newPager);
                }
                else
                    $(pageBodySelector + " " + paginationSelector).empty();
            } else {
                $(nopAccFilterClass).replaceWith(result);
                if ($(nopAccFilterClass + ' ' + productHtmlClass + ' ' + paginationSelector).length > 0) {
                    newPager = $(nopAccFilterClass + " " + productHtmlClass + " " + paginationSelector)[0].outerHTML;
                    if ($(pageBodySelector + ' ' + paginationSelector).length > 0)
                        $(paginationSelector).replaceWith(newPager);
                    else
                        $(pageBodySelector).append(newPager);
                }
                else
                    $(pageBodySelector + " " + paginationSelector).empty();

                newItemGrid = $(nopAccFilterClass + " " + productHtmlClass + " " + productReplaceSelector).html();
                $(viewmodeClassName + ":not(" + featuredProductGridSelector + ") > " + productReplaceSelector).append(newItemGrid);
            }
        }
        isInfinit = 0;
        /*remove after append*/
        $(productHtmlClass + " " + productReplaceSelector).remove();
        $(productHtmlClass + " " + paginationSelector).remove();
    }).error(function (e) {
        console.log(e.status + " :" + e.responseText);
    }).complete(function (e) {
        $(".ajax-loading-block-window").attr("style", "display:none;");
        $("body").removeClass("hidescroll");
        Customfunction();
        PagerCode();
        PriceRange();
        myScroll();
    });
}

//custom scrollbar
(function ($) {
    $(window).on("load", function () {
        myScroll();
    });
})(jQuery);

function myScroll() {
    $(".content-d3").mCustomScrollbar({ theme: "dark-3" });
}

//loading more
function showNext() {
    $('.search-infinite-next').attr('style', 'display:block;');
    var nextPageNumber = $('.page-body' + ' ' + paginationSelector + ' .next-page a').attr("data-newpagenumber");
    if (nextPageNumber !== null && nextPageNumber !== '' && typeof nextPageNumber !== 'undefined') {
        whenToShow = parseInt(nextPageNumber) + parseInt(whenToShowAfterLoadMore) - 1;
        AjaxCall(nextPageNumber, null);
        isInfinit = 1;
    }
}

function openMenu() {
    $(nopAccFilterClass + ".nopAcc-plus-mobile.sidenav").css("width", "90%");
    $(nopAccFilterClass + ".nopAcc-plus-mobile.sidenav").css("left", "0%");
    $(nopAccFilterClass + ".nopAcc-plus-mobile.sidenav").css("overflow-y", "auto");
    $(nopAccFilterClass + ".nopAcc-plus-mobile.sidenav").css("overflow-x", "auto");
    $("body").addClass("hidescroll");
    //$('.header-top-bar, .mobile-navigation-bar, .header-line, .header, .header-menu, .nopAccPlus_StickyMessage, .responsive-nav-wrapper.stick, .responsive-nav-wrapper, .responsive-nav-wrapper-parent, .admin-header-links').css({
    //    "display": "none"
    //});
    $('<div class="nop-filter-overlay"></div>').appendTo(".master-column-wrapper");
}

function closeMenu() {
    $(nopAccFilterClass + ".nopAcc-plus-mobile.sidenav").css("width", "0%");
    $(nopAccFilterClass + ".nopAcc-plus-mobile.sidenav").css("overflow-y", "hidden");
    $(nopAccFilterClass + ".nopAcc-plus-mobile.sidenav").css("overflow-x", "hidden");
    $("body").removeClass("hidescroll");
    //$('.header-top-bar, .mobile-navigation-bar, .header-line, .header, .header-menu, .nopAccPlus_StickyMessage, .responsive-nav-wrapper.stick, .responsive-nav-wrapper, .responsive-nav-wrapper-parent, .admin-header-links').css({
    //    "display": "block"
    //});
    $(".nop-filter-overlay").remove();
}

function removeURLParameter(url, parameter) {
    //prefer to use l.search if you have a location/link object
    var urlparts = url.split('?');
    if (urlparts.length >= 2) {

        var prefix = encodeURIComponent(parameter) + '=';
        var pars = urlparts[1].split(/[&;]/g);

        //reverse iteration as may be destructive
        for (var i = pars.length; i-- > 0;) {
            if (pars[i].lastIndexOf(prefix, 0) !== -1) {
                pars.splice(i, 1);
            }
        }
        if (pars.length === 0) {
            url = urlparts[0];
        }
        else {
            url = urlparts[0] + '?' + pars.join('&');
        }

        return url;
    } else {
        return url;
    }
}

function SortByCode() {
    if ($(productSortBy).length !== 0) {
        $(productSortBy)[0].setAttribute("onchange", "AjaxCall(null,null);");
        $(productSortBy + " option").each(function () {
            var finalSortOrder = "0";
            var getOrder = $(this).val();
            var newgetOrder = /orderby=(\d+)/.exec(getOrder.toLowerCase());
            newgetOrder !== null && newgetOrder.length > 1 && (finalSortOrder = newgetOrder[1]);
            $(this).val(finalSortOrder);
        });
    }

    var getOrder = window.location.href;
    if (getOrder !== null) {
        var newgetOrder = /orderby=(\d+)/.exec(getOrder.toLowerCase());
        if (newgetOrder !== null) {
            newgetOrder !== null && newgetOrder.length > 1 && (getOrder = newgetOrder[1]);
            $(productSortBy).val(getOrder);
        }
        else {
            $(productSortBy).val($(productSortBy + ' option[selected]').val());
        }
    }
}

function DisplayPerPage() {
    if ($(pageSizeSelector).length !== 0) {
        $(pageSizeSelector)[0].setAttribute("onchange", "AjaxCall(null,null,0);");
        //$(pageSizeSelector + " option").each(function () {
        //    var finalPageSize = DefaultPageSize;
        //    var getPageSize = $(this).val();
        //    var newPageSize = /pagesize=(\d+)/.exec(getPageSize.toLowerCase());
        //    newPageSize !== null && newPageSize.length > 1 && (finalPageSize = newPageSize[1]);
        //    $(this).val(finalPageSize);
        //});
    }

    var getCurrentURL = window.location.href;
    if (getCurrentURL !== null) {
        var getPageSize = DefaultPageSize;
        //https://stackoverflow.com/questions/8737025/retaining-selected-dropdown-option-on-postback
        //var newPageSize = getCurrentURL.match(/[?&]pagesize=([^&#]+)/) || [];
        var newPageSize = /pagesize=(\d+)/.exec(getCurrentURL.toLowerCase());
        if (newPageSize !== null) {
            newPageSize !== null && newPageSize.length > 1 && (getPageSize = newPageSize[1]);
            $(pageSizeSelector).val(getPageSize);
        }
        else {
            $(pageSizeSelector).val($(pageSizeSelector + ' option[selected]').val());
        }
    }
}

function ViewMode() {
    //product-viewmode

    if ($(".product-viewmode .selected").length !== 0) {
        //dropdown logic
        if ($(".product-viewmode #products-viewmode").length !== 0) {
            $("#products-viewmode")[0].setAttribute("onchange", "ViewModeChange(this.value);");
            $("#products-viewmode option").each(function () {
                var newViewmode = "grid";
                var getvalue = $(this).val();
                var finalviewmode = getvalue.match(/[?&]viewmode=([^&#]+)/) || [];
                finalviewmode !== null && finalviewmode.length > 1 && (newViewmode = finalviewmode[1]);
                $(this).val(newViewmode);
            });
        }

        var getviewmode = window.location.href;
        if (getviewmode !== null) {
            var newviewmode = getviewmode.match(/[?&]viewmode=([^&#]+)/) || [];
            if (newviewmode !== null && newviewmode.length >= 1) {
                newviewmode !== null && newviewmode.length > 1 && (getviewmode = newviewmode[1]);
                $("#products-viewmode").val(getviewmode);
            }
            else {
                $("#products-viewmode").val($('#products-viewmode option[selected]').val());
            }
        }
    }
    else {
        //anchor logic
        $('.product-viewmode').find('a').each(function () {
            var viewmode_href = $(this).attr("href");
            var finalviewmode = "grid";
            if (viewmode_href !== null && typeof viewmode_href !== 'undefined') {
                var newNumber = viewmode_href.match(/[?&]viewmode=([^&#]+)/) || [];
                newNumber !== null && newNumber.length > 1 && (finalviewmode = newNumber[1]);
            }
            $(this).removeAttr("href");
            $(this).attr("data-viewmode", finalviewmode);
        });
    }
    //nopAccPlusSolrProductCount();
}

function ViewModeChange(viewmode) {
    var url = url = window.location.href;
    (url = new URL(url)).searchParams.set("viewmode", viewmode);
    window.history.replaceState({}, document.title, url);
    AjaxCall(null, null, 0, 0);
    //nopAccPlusSolrProductCount();
}

function npAccFiltersPushStateUrl(stateUrl) {
    manualStateChange = false;
    History.pushState({ loadUrl: stateUrl, rand: Math.random() }, document.title, stateUrl);
    return false;
}

function PagerCode() {
    $(".ajax-loading-block-window").attr("style", "display:none;");
    $("body").removeClass("hidescroll");
    var showNextbtnHtml = $(nopAccFilterClass + " " + productHtmlClass + " .search-infinite-next").wrap("<div></div>").parent().html();
    $("div.search-infinite-next").remove();
    $('.page-body').append(showNextbtnHtml);
    $(".search-infinite-next").attr("style", "display:none;");
    if ($("#nopAccplus-facetdata").attr("data-infinitescroll").toLowerCase() === "true" && $("#nopAccplus-facetdata").attr("data-enableajaxrequestfacet").toLowerCase() === "true") {
        $(paginationSelector).hide();
    }

    $(paginationSelector).find('a').each(function () {
        var pageNumber = $(this).attr("href");
        var finalpageNumber = "";
        if (pageNumber !== null && typeof pageNumber !== 'undefined') {
            var newNumber = /pagenumber=(\d+)/.exec(pageNumber.toLowerCase());
            newNumber !== null && newNumber.length > 1 && (finalpageNumber = newNumber[1]);
            if (newNumber === null)
                finalpageNumber = 1;

            (url = new URL(this.baseURI)).searchParams.set("pagenumber", finalpageNumber);
            $(this).attr("href", url.href)
            $(this).attr("data-newpagenumber", finalpageNumber);
            $(this).removeAttr('data-page');
        }
    });

    var nextPageNumber = $(paginationSelector + ' .next-page a').attr("data-newpagenumber");
    if (nextPageNumber !== null && nextPageNumber !== '' && typeof nextPageNumber !== 'undefined') {
        shownextbtn = nextPageNumber;
        if (parseInt(shownextbtn) > parseInt(whenToShow) && $('.next-page').text() !== "" && $("#nopAccplus-facetdata").attr("data-infinitescroll").toLowerCase() === "true") {
            $('.search-infinite-next').attr('style', 'display:block;');
        }
    }
}

function PriceRange() {
    $("#nopAccPlus-priceSlider").slider({
        range: true,
        isRTL: true,
        min: parseInt($("#nopAccplus-facetdata").attr("data-minprice")),
        max: parseInt($("#nopAccplus-facetdata").attr("data-maxprice")),
        values: [parseInt($("#nopAccplus-facetdata").attr("data-selectedminprice")), parseInt($("#nopAccplus-facetdata").attr("data-selectedmaxprice"))],
        slide: function (event, ui) {
            $("#nopAccPlus-minVal").html(ui.values[0]);
            $("#nopAccPlus-maxVal").html(ui.values[1]);
            $(ui.handle).find('.tooltip_bottom').text(ui.value);
        },
        create: function (event, ui) {
            var tooltip_bottom = $('<div class="tooltip_bottom" />');
            $(event.target).find('.ui-slider-handle').append(tooltip_bottom);

        },
        change: function (event, ui) {
            $('#hidden_bottom').attr('value', ui.value);
        },
        stop: function (event, ui) {
            var priceName = seo_Price;
            var oldUrl = document.location.href;
            var newUrl = removeURLParameter(oldUrl, priceName.toString());
            if (newUrl.indexOf('?') > 0) {
                var url = newUrl + "&" + priceName + "=" + ui.values[0] + "-" + ui.values[1];
            } else {
                url = newUrl + "?" + priceName + "=" + ui.values[0] + "-" + ui.values[1];
            }
            AjaxCall(null, url);

        }
    }).on({
        mouseover: function (event, ui) { $(event.target).find('.tooltip_bottom').addClass('showTooltip'); },
        mouseout: function (event, ui) { $(event.target).find('.tooltip_bottom').removeClass('showTooltip'); },
        click: function (event, ui) { $(event.target).find('.tooltip_bottom').addClass('showTooltip'); },
    });
    $("#nopAccPlus-minVal").html($("#nopAccPlus-priceSlider").slider("values", 0));
    $("#nopAccPlus-maxVal").html($("#nopAccPlus-priceSlider").slider("values", 1));
    $("#nopAccPlus-priceSlider span:first .tooltip_bottom").html(parseInt($("#nopAccplus-facetdata").attr("data-selectedminprice")));
    $("#nopAccPlus-priceSlider span:last-child .tooltip_bottom").html(parseInt($("#nopAccplus-facetdata").attr("data-selectedmaxprice")));

    //replace new numbers of product
    nopAccPlusSolrProductCount();
}

function nopAccPlusSolrProductCount() {
    if (parseInt($("#nopAccplus-facetdata").attr("data-numberofproductfound")) === 0 && shownumberofproductsfound.toLowerCase() === "true") {
        $('.solr-products-count').remove();
        $(viewmodeClassName + ':not(' + featuredProductGridSelector + ')').before("<div class='solr-products-count'>" + $("#nopAccplus-facetdata").attr("data-numberofproductfoundstring") + "</div>");
    }
    else if (shownumberofproductsfound.toLowerCase() === "true") {
        $('.solr-products-count').remove();
        $(viewmodeClassName + ':not(' + featuredProductGridSelector + ')').before("<div class='solr-products-count'>" + $("#nopAccplus-facetdata").attr("data-numberofproductfoundstring") + "</div>");
    }
}

//nopAccPlus - showMore & less functionality
function nopAccPlusshowMore() {
    var liList = $(this).prev().find(".nopAccPlus-NoVisiable");
    if ($(this).find('span').text() === resourceLess) {
        for (i = 0; i < liList.length; i++) {
            $(liList[i]).removeClass("nopAccPlus-Show").addClass("nopAccPlus-Hide");
        }
        var length = $(this).prev().find(".nopAccPlus-NoVisiable").length;
        $(this).find("span").text(length + ' ' + resourceMore);
    }
    else {
        for (i = 0; i < liList.length; i++) {
            $(liList[i]).removeClass("nopAccPlus-Hide").addClass("nopAccPlus-Show");
        }
        $(this).find("span").text(resourceLess);
    }
}

// Used js for BackTop Page Scrolling
(function ($) {
    $.fn.backTop = function (options) {
        var backBtn = this;
        var settings = $.extend({
            'position': 400,
            'speed': 500
        }, options);

        //Settings
        var position = settings['position'];
        var speed = settings['speed'];

        backBtn.css({
            'right': 40,
            'bottom': 40,
            'position': 'fixed'
        });

        $(document).scroll(function () {
            var pos = $(window).scrollTop();

            if (pos >= position) {
                backBtn.fadeIn(speed);
            } else {
                backBtn.fadeOut(speed);
            }
        });

        backBtn.click(function () {
            $("html, body").animate({
                scrollTop: 0
            },
                {
                    duration: 1200
                });
        });
    };
}(jQuery));

$('#backTop').backTop({
    'position': 200,
    'speed': 500
});

//Searching Function
function nopAccPlus_seeMoreFunction(id) {
    var input, filter, ul, li, a, i, newId;
    newId = $.escapeSelector(id);
    newId = "#" + newId;
    input = document.getElementById("nopAccPlus-myInput-" + id);
    filter = input.value.toUpperCase();
    ul = document.getElementById(id);
    li = ul.getElementsByTagName("li");
    for (i = 0; i < li.length; i++) {
        a = li[i].getElementsByTagName("label")[0];
        if (a.innerText.toUpperCase().indexOf(filter) > -1) {
            if ($(li[i]).hasClass("nopAccPlus-NoVisiable") === true) {
                if (filter === "") {
                    $(li[i]).removeClass("nopAccPlus-Show").addClass("nopAccPlus-Hide");
                    $(newId).next(".nopAccPlus-showMore").hide();
                }
                else {
                    $(li[i]).removeClass("nopAccPlus-Hide").addClass("nopAccPlus-Show");
                    $(newId).next(".nopAccPlus-showMore").hide();
                }
            }
            else {
                if (filter === "") {
                    $(li[i]).removeClass("nopAccPlus-Hide").addClass("nopAccPlus-Show");
                    $(newId).next(".nopAccPlus-showMore").hide();
                }
                else {
                    $(li[i]).removeClass("nopAccPlus-Hide").addClass("nopAccPlus-Show");
                    $(newId).next(".nopAccPlus-showMore").hide();
                }
            }
        } else {
            if ($(li[i]).hasClass("nopAccPlus-NoVisiable") === true) {
                $(li[i]).removeClass("nopAccPlus-Show").addClass("nopAccPlus-Hide");
                $(newId).next(".nopAccPlus-showMore").hide();
            }
            else {
                $(li[i]).removeClass("nopAccPlus-Show").addClass("nopAccPlus-Hide");
                $(newId).next(".nopAccPlus-showMore").hide();
            }
        }
    }
    if (filter === "") {
        var length = $(ul).find(".nopAccPlus-NoVisiable").length;
        var text = length + ' ' + resourceMore;
        $(ul).next('.nopAccPlus-showMore').children('span').text(text);
        $(newId).next(".nopAccPlus-showMore").show();
    }
}

$(function () {
    // history.js
    History.Adapter.bind(window, 'statechange', function () {
        var State = History.getState();
        var url = State.data.loadUrl === 'undefined' ? State.data.loadUrl : State.url;
        if (typeof manualStateChange !== 'undefined' && manualStateChange === true) {
            AjaxCall(null, url, 1);
        }
        else if (typeof State.data.loadUrl === 'undefined') {
            AjaxCall(null, url, 1);
        }
        manualStateChange = true;
        return false;
    });
});

$(window).scroll(function () {
    var newviewmodeClassName = window.location.href.match(/[?&]viewmode=([^&#]+)/) || [];
    if (newviewmodeClassName.length !== 0) {
        if (newviewmodeClassName[1].toLowerCase() === "list")
            viewmodeClassName = listClassName;
        else if (newviewmodeClassName[1].toLowerCase() === "grid")
            viewmodeClassName = gridClassName;
    }

    if ($(window).scrollTop() >= $(pageBodySelector).outerHeight() - scrolltotopheight && isInfinit === 0 && $("#nopAccplus-facetdata").attr("data-infinitescroll").toLowerCase() === "true" && $("#nopAccplus-facetdata").attr("data-enableajaxrequestfacet").toLowerCase() === "true") {
        var nextPageNumber = $(paginationSelector + ' .next-page a').attr("data-newpagenumber");
        if (nextPageNumber !== null && nextPageNumber !== '' && typeof nextPageNumber !== 'undefined') {
            shownextbtn = parseInt(nextPageNumber);

            if (parseInt(shownextbtn) > parseInt(whenToShow) && $(paginationSelector + ' .next-page').text() !== "") {
                $('.search-infinite-next').attr('style', 'display:block;');
                whenToShow = parseInt(whenToShowAfterLoadMore);
            }
            else {
                $('.search-infinite-next').attr('style', 'display:none;');
                AjaxCall(nextPageNumber, null);
                isInfinit = 1;
            }
        } else {
            whenToShow = parseInt(whenToShowAfterLoadMore);
        }
    }
});

function scrolltoTopAfterFacet() {
    if (EnableScrollToTopFacetApplies.toLowerCase() === "true") {
        ScrollToTop();
    }
}

$(paginationSelector + " li a").on("click", function () {
    var newpagenumber = $(this).attr("data-newpagenumber");
    AjaxCall(newpagenumber, null);
    scrolltoTopAfterFacet();
    return false;
});

$(".product-viewmode a").on("click", function () {
    var viewmode = $(this).attr("data-viewmode");
    $(".product-viewmode a").removeClass("selected");
    $(this).addClass("selected");
    ViewModeChange(viewmode);
});

$(document).on("click", nopAccFilterClass + " .nopAcc-facet-filter", function () {
    var e = $(this).attr("data-facetURL");
    AjaxCall(null, e, 0);
    scrolltoTopAfterFacet();
    npAccFiltersPushStateUrl(window.location.href);
});

$(productSortBy).on("change", function () {
    npAccFiltersPushStateUrl(window.location.href);
    scrolltoTopAfterFacet();
});

$(pageSizeSelector).on("change", function () {
    npAccFiltersPushStateUrl(window.location.href);
    scrolltoTopAfterFacet();
});

$("#products-viewmode").on("change", function () {
    npAccFiltersPushStateUrl(window.location.href);
    scrolltoTopAfterFacet();
    //nopAccPlusSolrProductCount();
});

$(".product-viewmode a").on("click", function () {
    npAccFiltersPushStateUrl(window.location.href);
    scrolltoTopAfterFacet();
});

$(window).load(function () {
    if ($(window).width() <= MobileViewScreenSize) {
        $(".nopAcc-plus-filter.nopAcc-plus-mobile").appendTo($(refineButtonSelector));
    }
});

$(window).resize(function () {
    if ($(window).width() <= MobileViewScreenSize) {
        $(".nopAcc-plus-filter.nopAcc-plus-mobile").appendTo($(refineButtonSelector));
    }
});

$(document).on("click", ".nopAcc-plus-filter.nopAcc-plus-mobile .nopAccPlus-mob-filter", openMenu);

$(document).on("click", ".product-filters-mobile-title .closebtn", closeMenu);

$(document).on("click", ".nopAccPlus-showMore", nopAccPlusshowMore);

$(document).on("click", ".nop-filter-overlay", closeMenu);

$(document).on("click", "#nopAcc-btnSearchWithin", searchWithin);

$(document).on("change", "input[type=checkbox]", function () {
    $(this).is(":checked") ? $(this).attr("checked", !0) : $(this).attr("checked", !1);
});

function searchWithin() {
    var searchTerm = $("#nopAccSearchTerm").val();
    if (searchTerm === '') {
        alert(SearchTermEmpty.toString());
    }
    else {
        var url = window.location.href;
        (url = new URL(url)).searchParams.set("term", searchTerm);
        url = url.href;
        window.history.replaceState({}, document.title, url);
        AjaxCall(null, url, null);
        scrolltoTopAfterFacet();
    }
}

$(document).keypress(function (event) {
    var keycode = (event.keyCode ? event.keyCode : event.which);
    if (keycode == '13' && $("#nopAccSearchTerm").is(":focus") == true) {
        searchWithin();
    }
});